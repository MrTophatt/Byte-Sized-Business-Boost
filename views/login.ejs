<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Login | Byte-Sized Business Boost</title>
        <link rel="icon" type="image/x-icon" href="/images/site/icon.svg">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="login.css">
    </head>
    <body class="p-5">
        <script>
            (async () => {
                const token = localStorage.getItem("userToken");
                if (!token) return;

                const res = await fetch("/api/users/me", {
                    headers: { "x-user-token": token }
                });

                if (res.ok) {
                    window.location.href = "/";
                }
            })();
        </script>

        <div class="login-box">
            <h2 class="mb-4">Welcome Back</h2>

            <form id="loginForm" class="auth-form mb-3">
                <h3 class="section-title">Log in</h3>
                <input id="loginIdentity" class="form-control mb-2" type="text" placeholder="Username or Email" required>
                <input id="loginPassword" class="form-control mb-2" type="password" placeholder="Password" required>
                <button class="btn btn-dark w-100" type="submit">Log In</button>
            </form>

            <p class="small mb-2">Need an account?</p>
            <a class="btn btn-outline-primary w-100 mb-3" href="/signup">Create account</a>

            <div class="divider my-3">
                <span>or</span>
            </div>

            <!-- Google Sign-In Button -->
            <div id="g_id_onload"
                data-client_id="<%= GOOGLE_CLIENT_ID %>"
                data-callback="handleGoogleLogin">
            </div>
            <div class="g_id_signin google-btn"
                data-theme="outline"
                data-size="large">
            </div>

            <span class="guest-link mt-3" id="guestBtn">Continue as Guest</span>
            <p id="authMessage" class="auth-message"></p>
        </div>

        <script src="https://accounts.google.com/gsi/client" async defer></script>
        <script src="auth.js"></script>
        <script>
            // Guest login
            document.getElementById("guestBtn").addEventListener("click", async () => {
                const res = await fetch("/api/users/generate", { method: "POST" });
                const user = await res.json();
                localStorage.setItem("userToken", user.token);
                window.location.href = "/";
            });
        </script>
    </body>
</html>